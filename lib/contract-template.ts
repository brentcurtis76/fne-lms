// Contract template with placeholders
// Replace this with your actual legal contract text

export const CONTRACT_TEMPLATE = `

<div style="text-align: center; font-weight: bold; margin-bottom: 20px;">
CONTRATO DE PRESTACIÓN DE SERVICIOS<br>
FUNDACIÓN INSTITUTO RELACIONAL (NUEVA EDUCACIÓN)<br>   
Y<br>
{{CLIENTE_NOMBRE_LEGAL}}<br>
Contrato {{CONTRATO_NUMERO}}
</div>
 



En Santiago de Chile, a {{FECHA_CONTRATO}}, entre {{CLIENTE_NOMBRE_LEGAL}}  Rol Único Tributario número {{CLIENTE_RUT}}, representada por {{CLIENTE_REPRESENTANTE}}, cédula nacional de identidad número 11.707.894-9, todos con domicilio para estos efectos en {{CLIENTE_DIRECCION}}, comuna de {{CLIENTE_COMUNA}}, ciudad de {{CLIENTE_CIUDAD}}, en adelante e indistintamente como “{{CLIENTE_NOMBRE_FANTASIA}}  ” por una parte, y por la otra parte, FUNDACIÓN INSTITUTO RELACIONAL (NUEVA EDUCACIÓN), Rol Único Tributario número 65.166.503-5, representada por don Arnoldo Cisternas Chávez, cédula nacional de identidad número 10.740.623-9, ambos domiciliados para estos efectos calle Carlos Silva Vildósola N° 10448, comuna de La Reina, en adelante indistintamente como “FUNDACIÓN INSTITUTO RELACIONAL (NUEVA EDUCACIÓN)”; se ha convenido el siguiente contrato de prestación de servicios:

PRIMERO: Antecedentes.

{{CLIENTE_NOMBRE_LEGAL}} , con personalidad jurídica y patrimonio propio, cuya finalidad es entregar una educación cristiana, inclusiva y de excelencia a todos sus estudiantes. Por su parte, FUNDACIÓN INSTITUTO RELACIONAL (NUEVA EDUCACIÓN) es una fundación cuyo objetivo es la prestación de servicios de asesoría, consultoría e investigación y desarrollo de políticas públicas en materias de educación, psicología social, desarrollo social y desarrollo sustentable.

SEGUNDO: Servicios Contratados

La FUNDACIÓN INSTITUTO RELACIONAL (NUEVA EDUCACIÓN) viene a implementar para el año 2025 el programa {{PROGRAMA_NOMBRE}} a los miembros seleccionados por el equipo de la comunidad educativa del {{CLIENTE_NOMBRE_FANTASIA}}, perteneciente a la {{CLIENTE_NOMBRE_LEGAL}}.

El {{CLIENTE_NOMBRE_FANTASIA}}, en consecuencia y por el presente instrumento, viene a contratar los servicios de la FUNDACIÓN INSTITUTO RELACIONAL (NUEVA EDUCACIÓN), a fin de que ejecute la capacitación y asesoría del Programa {{PROGRAMA_NOMBRE}}.

Para la realización del programa antes referido, la FUNDACIÓN INSTITUTO RELACIONAL (NUEVA EDUCACIÓN) utilizará el personal de su exclusiva subordinación y dependencia, idóneo que sea necesario. La calificación de la idoneidad de tal personal corresponderá exclusivamente a la FUNDACIÓN INSTITUTO RELACIONAL (NUEVA EDUCACIÓN).

TERCERO: Precio y Forma Pago

Las Partes acuerdan que {{CLIENTE_NOMBRE_LEGAL}} pagará a FUNDACIÓN INSTITUTO RELACIONAL (NUEVA EDUCACIÓN) la suma total de {{IF_UF}}{{CONTRATO_VALOR_UF}}{{/IF_UF}}{{IF_CLP}}{{CONTRATO_VALOR_CLP}}{{/IF_CLP}} correspondiente al total del programa.

Para los efectos del pago de los servicios, FUNDACIÓN INSTITUTO RELACIONAL (NUEVA EDUCACIÓN) emitirá una factura por los montos previamente definidos en este contrato y/o en los Anexos que se acordaren, los que se pagarán en el plazo acordado por ambas partes. El pago se realizará en {{CUOTAS_CANTIDAD}} cuotas, detalladas a continuación:

{{CUOTAS_DETALLE}}

En el evento que el {{CLIENTE_NOMBRE_FANTASIA}}   no diese cumplimiento a su obligación de pago de los servicios prestados por FUNDACIÓN INSTITUTO RELACIONAL (NUEVA EDUCACIÓN) podrá suspender de inmediato el servicio prestado hasta que el pago sea realizado, sin perjuicio de su derecho a poner término al presente contrato. Lo anterior, sin perjuicio que las partes acuerden una prórroga en el plazo señalado.

Por otro lado, las partes acuerdan que en el evento que el {{CLIENTE_NOMBRE_FANTASIA}}   decida proponer una modificación en los servicios acordados, éste deberá informar a la FUNDACIÓN INSTITUTO RELACIONAL (NUEVA EDUCACIÓN) con no menos de una semana de anticipación a la verificación de la modificación propuesta.


CUARTO: Adición de participantes o bloques de asesoría

Si el colegio desea agregar destinatarios al programa, podrá hacerlo mediante anexo de contrato, sin extender la fecha de término. El monto adicional será acordado y estipulado en dicho anexo.

Si el colegio desea agregar horas de formación/asesoría o visitas técnicas, esto podrá realizarse mediante anexo de contrato, sin extender la fecha de término. El monto adicional será acordado y estipulado en dicho anexo.


QUINTO: Con respecto a la cancelación de horas y/o jornadas de asesoría/formación:
1.	Las horas de asesoría/formación online canceladas con al menos 48 horas de anticipación deberán ser reagendadas dentro de la siguiente semana para ser ejecutadas de acuerdo a la disponibilidad del equipo de la FUNDACIÓN NUEVA EDUCACIÓN dentro de los siguientes 30 días.
2.	Las horas de asesoría/formación online canceladas con menos de 48 horas de anticipación se considerarán como realizadas.
3.	Las horas de asesoría/formación presencial canceladas por el colegio con al menos 2 semanas de anticipación podrán ser recuperadas online según disponibilidad del equipo de la FUNDACIÓN NUEVA EDUCACIÓN dentro de los siguiente 30 días. Si el colegio quisiera recuperarlas de manera presencial y el equipo de la FNE tiene agenda disponible, los gastos de traslado y alojamiento deberán ser asumidos por el colegio para las horas/jornadas a ser recuperadas.
4.	Las horas de asesoría/formación presencial canceladas con menos de 2 semanas de anticipación se considerarán como realizadas.
5.	En caso de cancelaciones por fuerza mayor (detallados en el punto Décimo Tercero) las sesiones serán reprogramadas según disponibilidad de la FUNDACIÓN NUEVA EDUCACIÓN, asegurando su realización dentro de los siguiente 30 días.
6.	Si la cancelación de las horas/jornadas agendadas es por parte de la FUNDACIÓN NUEVA EDUCACIÓN, las sesiones deberán ser reagendadas dentro de los 7 días siguientes, para ser realizadas dentro de los siguientes 30 días, según la disponibilidad de ambas partes. En caso de que no se pueda encontrar una fecha la recuperación de dichas horas no podrá extenderse más allá de la fecha de término del contrato. Los costos incurridos para efectuar la recuperación serán de responsabilidad de la FUNDACIÓN NUEVA EDUCACIÓN.

SEXTO: Relación entre las partes

FUNDACIÓN INSTITUTO RELACIONAL (NUEVA EDUCACIÓN) declara ser una fundación sin fines de lucro, autónoma e independiente y nada en este contrato se interpretará como constitutivo de una relación societaria entre las partes ni de ninguna otra naturaleza que la contenida en el presente contrato, por lo que FUNDACIÓN INSTITUTO RELACIONAL (NUEVA EDUCACIÓN) actúa por su exclusiva cuenta y riesgo. En consecuencia, se deja expresa constancia que ni FUNDACIÓN INSTITUTO RELACIONAL (NUEVA EDUCACIÓN), ni el personal que éste destine a la ejecución de las labores propias de los servicios que le presta a {{CLIENTE_NOMBRE_FANTASIA}}   y a que se refiere este contrato, se encuentra sujeto a subordinación o dependencia alguna de {{CLIENTE_NOMBRE_FANTASIA}}  .


SÉPTIMO: Obligaciones de las partes.
Para la ejecución y el cumplimiento de los objetivos del presente convenio, las partes se obligan a lo siguiente:

{{CLIENTE_NOMBRE_LEGAL}}   
1.	Pagar oportunamente las cuotas en las fechas establecidas del presente convenio a la FUNDACIÓN INSTITUTO RELACIONAL (NUEVA EDUCACIÓN).
2.	Disponer de una persona que se responsabilice por los pagos y actúe como contraparte del área de finanzas y gestión de la Fundación.
3.	Disponer de una persona encargada de la comunicación continúa con el área de implementación de la Fundación.
4.	Participar y coordinar las acciones entre el establecimiento y la Fundación, dentro de los márgenes del convenio.
5.	Facilitar a FUNDACIÓN INSTITUTO RELACIONAL (NUEVA EDUCACIÓN) los medios necesarios para llevar a cabo las tareas contratadas.
6.	Disponer de horarios y lugar físico para las reuniones entre la coordinadora del programa y el equipo directivo.
7.	El personal de FUNDACIÓN INSTITUTO RELACIONAL (NUEVA EDUCACIÓN) que se desempeñe en labores propias del programa {{PROGRAMA_NOMBRE}}, no queda ni podrá quedar sujeto a la supervigilancia, subordinación ni dependencia de ningún trabajador de {{CLIENTE_NOMBRE_LEGAL}}.

FUNDACIÓN INSTITUTO RELACIONAL (NUEVA EDUCACIÓN)   
1.	Entregar a los docentes, capacitación y material para la inmersión, diseño, implementación, evaluación y sistematización del programa {{PROGRAMA_NOMBRE}}.
2.	Apoyar y acompañar a los docentes y al equipo directivo, para lograr una exitosa implementación del programa.
3.	Realizar reuniones con equipos directivos del establecimiento educacional para facilitar la instalación de capacidades y crear un espacio de trabajo técnico pedagógico. El acompañamiento a los docentes y al equipo directivo podrá ser realizado tanto de manera presencial como virtual, según lo acuerden las partes. En el caso de que las medidas sanitarias vigentes o cualquier otra circunstancia imprevista así lo requieran, todas las actividades de acompañamiento podrán desarrollarse de manera completa en modalidad virtual, asegurando la continuidad y calidad del programa sin interrupciones.
4.	Corresponde única y exclusivamente a FUNDACIÓN INSTITUTO RELACIONAL (NUEVA EDUCACIÓN) el pago de las remuneraciones, gratificaciones, cotizaciones previsionales y de salud (A.F.P, Isapre o FONASA, AFC Chile), las retenciones, pagos tributarios y demás prestaciones laborales a que haya lugar. En este sentido FUNDACIÓN INSTITUTO RELACIONAL (NUEVA EDUCACIÓN) exime de toda responsabilidad a {{CLIENTE_NOMBRE_LEGAL}}. 
5.	respecto de cualquier obligación laboral que le quepa al primero respecto de los trabajadores de FUNDACIÓN INSTITUTO RELACIONAL (NUEVA EDUCACIÓN).

Las Partes dejan constancia que es condición determinante de la celebración, ejecución y duración del presente Contrato, que FUNDACIÓN INSTITUTO RELACIONAL (NUEVA EDUCACIÓN) cumpla oportunamente todas y cada una de las obligaciones que la legislación del Trabajo y Previsión y los Contratos que celebren le imponen respecto de los trabajadores que destine a las labores propias del servicio

Podrá {{CLIENTE_NOMBRE_LEGAL}}, por intermedio del Coordinador que designe, comprobar el cumplimiento de esta cláusula, obligándose la FUNDACIÓN INSTITUTO RELACIONAL (NUEVA EDUCACIÓN) a proporcionar todos los antecedentes que al respecto le sean solicitados, previo aviso de solicitud por escrito.


OCTAVO: Confidencialidad

FUNDACIÓN INSTITUTO RELACIONAL (NUEVA EDUCACIÓN) expresamente asume la obligación de guardar confidencialidad, respecto de toda la información de {{CLIENTE_NOMBRE_LEGAL}} o sus dependientes, que sea de su propiedad o que mantenga en sus dependencias. En este sentido se obliga la FUNDACIÓN INSTITUTO RELACIONAL (NUEVA EDUCACIÓN) a guardar esta confidencialidad y declara no hacer uso de dicha información bajo ningún aspecto. La {{CLIENTE_NOMBRE_LEGAL}} se obliga a idéntico deber de confidencialidad respecto de FUNDACIÓN INSTITUTO RELACIONAL (NUEVA EDUCACIÓN) o sus dependientes. Lo anterior, sin perjuicio de la información cuya transmisión o difusión sea necesaria para la ejecución del contrato o requerida por las autoridades competentes.


NOVENO: Garantías de FUNDACIÓN INSTITUTO RELACIONAL (NUEVA EDUCACIÓN)   

FUNDACIÓN INSTITUTO RELACIONAL (NUEVA EDUCACIÓN) garantiza a {{CLIENTE_NOMBRE_LEGAL}} lo siguiente:
a.	La aceptación de FUNDACIÓN INSTITUTO RELACIONAL (NUEVA EDUCACIÓN) a realizar el servicio de conformidad con este Contrato, la cual no viola ningún contrato u obligación FUNDACIÓN INSTITUTO RELACIONAL (NUEVA EDUCACIÓN) y un tercero;
b.	El cumplimiento de todas las leyes y regulaciones que sean aplicables a la ejecución de este contrato, incluyendo las leyes laborales y tributarias; y
c.	Proveer del personal idóneo que sea necesario, de acuerdo con lo especificado en la cláusula segunda, para la realización del programa. Dicho personal será seleccionado, capacitado y contratado por FUNDACIÓN INSTITUTO RELACIONAL (NUEVA EDUCACIÓN) y laborará bajo su exclusiva dependencia y subordinación.
d.	El cumplimiento de los requisitos estipulados en el presente contrato o en los anexos que se acuerden.


DÉCIMO: Responsabilidades.

FUNDACIÓN INSTITUTO RELACIONAL (NUEVA EDUCACIÓN) será responsable, conforme a las reglas generales de la responsabilidad contractual, por la infracción a sus obligaciones asumidas en el presente contrato; en particular, a su obligación de prestar los servicios contratados; a su obligación de dar cumplimiento a las obligaciones laborales, tributarias y de seguridad social con sus propios trabajadores, y a las obligaciones expresamente señaladas en este contrato o sus anexos.

Por su parte, {{CLIENTE_NOMBRE_LEGAL}} será responsable conforme a las reglas generales de la responsabilidad contractual por la infracción a sus obligaciones asumidas en el presente contrato; en particular, a su obligación de pagar por los servicios prestados, y a las obligaciones expresamente señaladas en este instrumento o sus anexos.


DÉCIMO PRIMERO: Vigencia y terminación

Este contrato regirá a partir de esta fecha y tendrá duración de {{CONTRATO_DURACION_COMPLETA}}, a contar de la suscripción del presente contrato hasta el {{CONTRATO_FECHA_FIN}}.

Con todo, cualquiera de las partes podrá en todo momento poner término al presente contrato, debiendo previamente notificar a la otra parte de su intención, por medio de una carta certificada con a lo menos 30 días de anticipación a la fecha de término, sin necesidad de invocar motivo, causal o razón alguna. 
Sin perjuicio de lo anterior, las partes podrán poner término a este Contrato inmediatamente en cualquier momento si cualquiera de ellas viola alguna de las disposiciones contenidas en este contrato, procediendo además la indemnización de los perjuicios causados a la parte cumplidora.


DÉCIMO SEGUNDO: Solución de controversias.

Cualquier dificultad o controversia que se produzca entre los contratantes respecto de la aplicación, interpretación, duración, validez o ejecución de este contrato o cualquier otro motivo será sometida a la jurisdicción de los tribunales ordinarios de justicia de la ciudad Santiago, fijando para dichos efectos domicilio en la ciudad indicada.


DÉCIMO TERCERO: Fuerza mayor.

Las partes contratantes quedarán exentas de responsabilidad por cualquier incumplimiento que se deba a un caso de fuerza mayor. Para tal efecto, se considerarán, como casos de fuerza mayor, entre otros que sean de similar naturaleza, los siguientes: reglamento u otra norma de Gobierno; guerra, conmoción, naufragio, terremoto, inundación, otros actos de la naturaleza, y cualquier otro señalado en el artículo 45 del Código Civil, que impida o demore el cumplimiento de las obligaciones pactadas, no obstante, la parte afectada haya empleado la máxima diligencia.

Si ocurrieran tales circunstancias, la parte afectada informará a la otra, sin demora y por escrito, la existencia del hecho, como tal hecho afectará al cumplimiento del Contrato, y la duración de este, procediendo de la misma manera para informar del término de tal hecho y, en ambos casos, acompañando los documentos justificativos correspondientes.

Tan pronto como los hechos constitutivos de fuerza mayor hubieran cesado en sus efectos, las Partes iniciarán o continuarán el cumplimiento de sus obligaciones afectadas.


DÉCIMO CUARTO: Domicilio del Contrato

Para todos los efectos legales, la FUNDACIÓN INSTITUTO RELACIONAL (NUEVA EDUCACIÓN) fija su domicilio en la ciudad de Santiago y la comuna de La Reina. La {{CLIENTE_NOMBRE_LEGAL}} fija su domicilio en la ciudad de {{CLIENTE_CIUDAD}} y la comuna de {{CLIENTE_COMUNA}}.


DÉCIMO QUINTO: Ejemplares

El presente contrato se firma en dos ejemplares, quedando uno en poder de cada una de las partes.

DÉCIMO SEXTO: Personerías.

{{IF_PERSONERIA_COMPLETA}}La personería de {{CLIENTE_REPRESENTANTE}} para representar a {{CLIENTE_NOMBRE_LEGAL}} consta en la Escritura Pública de fecha {{CLIENTE_FECHA_ESCRITURA}}, suscrita ante {{CLIENTE_NOMBRE_NOTARIO}}, Notario Público de {{CLIENTE_COMUNA_NOTARIA}}.{{/IF_PERSONERIA_COMPLETA}}{{IF_PERSONERIA_SIMPLE}}La personería de {{CLIENTE_REPRESENTANTE}} para representar a {{CLIENTE_NOMBRE_LEGAL}} consta en los instrumentos legales correspondientes.{{/IF_PERSONERIA_SIMPLE}}

La personería de don Arnoldo Cisternas Chávez, para actuar en representación de FUNDACIÓN INSTITUTO RELACIONAL (NUEVA EDUCACIÓN), consta en los "Estatutos Fundación Instituto Relacional" otorgados por la Municipalidad de la Reina con fecha 08 de marzo del año 2018.

`;

// Function to replace placeholders with actual data
export function generateContractFromTemplate(contractData: any): string {
  let contract = CONTRACT_TEMPLATE;
  
  // Date formatting
  const formatDate = (dateString: string) => {
    return new Date(dateString).toLocaleDateString('es-CL');
  };
  
  // Determine currency type (default to UF for existing contracts)
  const isUF = !contractData.tipo_moneda || contractData.tipo_moneda === 'UF';
  const isCLP = contractData.tipo_moneda === 'CLP';
  
  // Currency formatting
  const formatCurrencyUF = (amount: number) => {
    return `UF ${amount.toLocaleString('es-CL', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
  };
  
  const formatCurrencyCLP = (amount: number) => {
    return `$${amount.toLocaleString('es-CL')}`;
  };
  
  const formatCurrencyByType = (amount: number) => {
    return isUF ? formatCurrencyUF(amount) : formatCurrencyCLP(amount);
  };
  
  // Calculate contract duration with exact years, months, and days
  const calculateDuration = (startDate: string, endDate: string) => {
    if (!startDate || !endDate) return 'duración a determinar';

    const start = new Date(startDate);
    const end = new Date(endDate);

    let years = end.getFullYear() - start.getFullYear();
    let months = end.getMonth() - start.getMonth();
    let days = end.getDate() - start.getDate();

    // Adjust for negative days
    if (days < 0) {
      months--;
      const lastDayOfPrevMonth = new Date(end.getFullYear(), end.getMonth(), 0).getDate();
      days += lastDayOfPrevMonth;
    }

    // Adjust for negative months
    if (months < 0) {
      years--;
      months += 12;
    }

    // Build the duration text with all components
    const parts: string[] = [];

    if (years > 0) {
      parts.push(`${years} ${years === 1 ? 'año' : 'años'}`);
    }

    if (months > 0) {
      parts.push(`${months} ${months === 1 ? 'mes' : 'meses'}`);
    }

    if (days > 0) {
      parts.push(`${days} ${days === 1 ? 'día' : 'días'}`);
    }

    if (parts.length === 0) {
      return 'misma fecha';
    } else if (parts.length === 1) {
      return parts[0];
    } else if (parts.length === 2) {
      return `${parts[0]} y ${parts[1]}`;
    } else {
      // 3 parts: "X años, Y meses y Z días"
      return `${parts[0]}, ${parts[1]} y ${parts[2]}`;
    }
  };
  
  // Generate installments details
  const generateCuotasDetalle = (cuotas: any[]) => {
    if (!cuotas || cuotas.length === 0) return 'Sin cuotas definidas';

    return cuotas.map(cuota =>
      `Cuota N° ${cuota.numero_cuota}: ${formatCurrencyByType(cuota.monto_uf || cuota.monto_clp || 0)} con vencimiento el ${formatDate(cuota.fecha_vencimiento)}`
    ).join('\n');
  };

  // Check if we have complete personería information (notary details)
  const hasPersoneriaCompleta = !!(
    contractData.cliente.fecha_escritura &&
    contractData.cliente.nombre_notario &&
    contractData.cliente.comuna_notaria
  );

  // Process conditional blocks first
  contract = processConditionalBlocks(contract, isUF, isCLP, hasPersoneriaCompleta);
  
  // Basic replacements - client names in uppercase to match FUNDACIÓN INSTITUTO RELACIONAL (NUEVA EDUCACIÓN)
  const replacements: { [key: string]: string } = {
    '{{FECHA_CONTRATO}}': formatDate(contractData.fecha_contrato),
    '{{CLIENTE_NOMBRE_LEGAL}}': (contractData.cliente.nombre_legal || '').toUpperCase(),
    '{{CLIENTE_NOMBRE_FANTASIA}}': (contractData.cliente.nombre_fantasia || '').toUpperCase(),
    '{{CLIENTE_RUT}}': contractData.cliente.rut || '',
    '{{CLIENTE_DIRECCION}}': contractData.cliente.direccion || '',
    '{{CLIENTE_COMUNA}}': contractData.cliente.comuna || '',
    '{{CLIENTE_CIUDAD}}': contractData.cliente.ciudad || '',
    '{{CLIENTE_REPRESENTANTE}}': (contractData.cliente.nombre_representante || '').toUpperCase(),
    '{{CLIENTE_RUT_REPRESENTANTE}}': contractData.cliente.rut_representante || '',
    '{{CLIENTE_FECHA_ESCRITURA}}': contractData.cliente.fecha_escritura || '',
    '{{CLIENTE_NOMBRE_NOTARIO}}': contractData.cliente.nombre_notario || '',
    '{{CLIENTE_COMUNA_NOTARIA}}': contractData.cliente.comuna_notaria || '',
    
    '{{PROGRAMA_NOMBRE}}': contractData.programa.nombre || '',
    '{{PROGRAMA_DESCRIPCION}}': contractData.programa.descripcion || '',
    '{{PROGRAMA_HORAS}}': contractData.programa.horas_totales?.toString() || '',
    '{{PROGRAMA_MODALIDAD}}': contractData.programa.modalidad || '',
    
    '{{CONTRATO_NUMERO}}': contractData.numero_contrato || '',
    '{{CONTRATO_VALOR_UF}}': formatCurrencyUF(contractData.precio_total_uf || 0),
    '{{CONTRATO_VALOR_CLP}}': formatCurrencyCLP(contractData.precio_total_clp || contractData.precio_total_uf || 0),
    '{{CONTRATO_MONEDA}}': isUF ? 'UF' : 'Pesos Chilenos',
    '{{CONTRATO_VALOR_NUMERO}}': (contractData.precio_total_uf || 0).toString(),
    '{{CONTRATO_FECHA_FIN}}': contractData.fecha_fin ? formatDate(contractData.fecha_fin) : '',
    '{{CONTRATO_DURACION_COMPLETA}}': calculateDuration(contractData.fecha_contrato, contractData.fecha_fin),
    
    '{{CUOTAS_DETALLE}}': generateCuotasDetalle(contractData.cuotas || []),
    '{{CUOTAS_CANTIDAD}}': (contractData.cuotas?.length || 0).toString(),
  };
  
  // Replace all placeholders in the template
  Object.entries(replacements).forEach(([placeholder, value]) => {
    contract = contract.replace(new RegExp(placeholder.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g'), value);
  });
  
  return contract;
}

// Process conditional blocks
function processConditionalBlocks(contract: string, isUF: boolean, isCLP: boolean, hasPersoneriaCompleta: boolean): string {
  // Process currency conditionals
  contract = processConditional(contract, 'IF_UF', isUF);
  contract = processConditional(contract, 'IF_CLP', isCLP);

  // Process personería conditionals
  contract = processConditional(contract, 'IF_PERSONERIA_COMPLETA', hasPersoneriaCompleta);
  contract = processConditional(contract, 'IF_PERSONERIA_SIMPLE', !hasPersoneriaCompleta);

  return contract;
}

// Process individual conditional blocks
function processConditional(text: string, condition: string, show: boolean): string {
  const regex = new RegExp(`{{${condition}}}([\\s\\S]*?){{/${condition}}}`, 'g');
  
  return text.replace(regex, (match, content) => {
    return show ? content : '';
  });
}